下面是根据我们前期讨论内容整理出的**综合查询与统计分析模块功能需求文档**，该文档采用标准 Markdown 格式，详细描述了模块功能、交互逻辑、数据导出、查询条件重置以及后端接口要求等内容。请审阅并指出需要补充或修改的部分。

------

# 综合查询与统计分析模块功能需求文档

**版本**：v1.1
 **生成日期**：2025-02-09
 **生效日期**：待定

------

## 1. 模块概述

本模块旨在为“近视预防干预系统”提供全面的数据查询、统计分析及报表展示功能。用户可以通过该模块实现多维度数据组合查询、图表统计展示及数据导出，支持学校、班级、学生、视力数据和干预效果等各个维度的统计与分析。模块设计遵循简洁、直观、响应式和可扩展的原则，并与系统其他模块（如数据录入、系统管理、用户管理等）相互配合。

------

## 2. 功能需求描述

页面分为两大区域：

### 2.1 页面总体结构

* **左侧导航栏**：固定导航区域，包含主要模块菜单。
* **右侧主操作区域**：主要展示和交互内容。

### 2.1 左侧菜单与顶部组合查询菜单

- **左侧菜单结构**
   左侧菜单按从上到下顺序排列，主要包含以下菜单项：
  - 首页
  - 综合查询
  - 视力数据
  - 干预效果
  - 数据维护
  - 系统管理
- **顶部组合查询菜单**
  - 每次点击左侧菜单项时，页面顶部会弹出对应的组合查询菜单。
  - 查询菜单右侧统一放置“查询”与“重置”两个按钮，分别用于启动查询和清除查询条件。
  - 下拉菜单支持模糊查询和“全选”操作，方便用户快速选择和重置查询条件。

### 2.2 各菜单项具体功能

#### 2.2.1 首页

- 功能描述
  - 默认展示系统基本统计信息，如学校数量、学生数量、性别比例、各近视程度占比、干预效果、视力改善人数及比例等。
  - 点击“首页”菜单时，返回首页界面，重新加载并展示最新统计数据。

#### 2.2.2 综合查询

- 默认展示
  - 默认在数据展示区以表格形式展示部分学生基本信息，固定展示列包括：
    - 姓名
    - 学校
    - 年级
    - 班级
    - 性别
    - 左眼裸眼视力
    - 右眼裸眼视力
    - 左眼干预后裸眼视力
    - 右眼干预后裸眼视力
- 顶部动态查询组合
  - 弹出查询类别组合菜单，支持以下查询条件：
    - 学校、年级、班级、姓名、性别
  - 每个下拉菜单下展示所有可选项，并支持模糊搜索和“全选”操作。
- 左侧二级菜单
  - “综合信息”菜单下弹出二级下拉菜单，包括：
    - 基本信息
    - 健康信息
    - 干预前视力
    - 干预后视力
  - 每个二级菜单点击后，显示带复选框的可选字段列表，默认选中：
    - 基本信息：姓名、性别、学校、年级、班级
    - 健康信息：默认无选中项
    - 干预前视力：默认选中“右眼-裸眼视力”、“左眼-裸眼视力”
    - 干预后视力：默认选中“右眼-干预-裸眼视力”、“左眼-干预-裸眼视力”
- 查询操作
  - 用户可通过选中复选框来决定展示哪些字段，查询结果将以横向滚动支持的表格形式展示。



#### 2.2.6 视力数据

- 顶部查询
  - 弹出下拉菜单：区域、学校、年级、班级、性别、年龄。
- 左侧二级菜单
  - “视力数据”菜单下弹出两个二级菜单：“干预前”和“干预后”。
  - **修改要求**：在每个二级菜单中，取消“正常视力”和“高度近视”两个复选框，仅保留其他视力等级选项。
- 数据展示
  - 展示区域采用图表和表格两种形式：图表直观展示各视力等级人数统计，表格展示具体数据。
  - 数据根据用户选择的条件动态统计计算后展示。

#### 2.2.7 干预效果

- 顶部查询
  - 弹出下拉组合查询菜单，包含：学校、年级、班级、性别、年龄（其中“年龄”下拉菜单需提供年龄区间的组合选择）。
- 左侧二级菜单
  - 在“干预效果”菜单下方弹出二级下拉菜单，包含以下六项：
    - 左眼视力
    - 右眼视力
    - 左眼球镜
    - 右眼球镜
    - 左眼柱镜
    - 右眼柱镜
  - 点击任一二级菜单后，弹出相同的复选框菜单，包含选项：“提升”、“维持”、“下降”。
- 数据展示
  - 展示区以表格形式展示统计数据，表格列包括：区域、学校、年级、班级、性别、年龄、人数。
  - 表格行名称分别对应“效果显著”、“有效”、“无效”，数据依据用户选择的查询条件动态统计计算后展示。

------

## 3. 数据导出功能

- **支持格式**：Excel、CSV、PDF和Markdown格式。

- 导出方式

  ：

  - 考虑到系统使用频率较低且数据量不大，建议在前端实现数据导出功能。
  - 导出数据与当前展示表格内容一致，确保数据格式统一。

- 用户操作

  ：

  - 在查询结果页面提供“导出”按钮，点击后生成对应格式的文件，支持文件下载。

------

## 4. 查询条件重置

- 重置功能描述

  ：

  - “重置”按钮点击后，将所有组合查询条件清空。
  - 对于复选框类查询条件，重置后只保留默认选项，其他选项取消。
  - 为方便用户操作，建议在复选框组中增加“全选”按钮，实现一次性选中所有选项或取消全部。

------

## 5. 后端接口要求

根据《近视预防干预系统需求文档_v1.1》和《近视预防干预系统开发文档_v1.1》的描述，前后端接口需满足以下要求：

- **数据查询 API**
  - URL 示例：`/api/students/query`
  - 支持多条件组合查询、分页及任意字段选择。
  - 返回数据格式须与前端展示表格结构匹配。
- **统计分析 API**
  - URL 示例：`/api/analysis/statistics`
  - 根据前端传入的组合查询条件，返回统计数据和图表数据。
  - 包含自动计算近视等级、干预效果评估（后续算法确定）等功能。
- **数据导出 API**
  - URL 示例：`/api/export`
  - 支持将查询及统计结果导出为 Excel、CSV、PDF和Markdown格式文件。
  - 若选择前端导出方式，则后端仅需提供数据接口；若由后端生成，则生成对应文件并返回下载链接。
- **重置查询条件**
  - 目前重置功能主要由前端实现，不需要额外调用接口，但需确保前端查询条件与后端查询数据保持一致。
- **接口安全与权限**
  - 部分接口（如数据修改、数据导入）仅允许系统管理员访问，其它接口支持根据用户角色进行权限控制。

------

## 6. 其他交互与细节要求

- **加载动画与错误处理**
  - AJAX 调用期间显示加载动画，数据加载完成后隐藏。
  - 出现错误时，在结果区显示错误提示信息。
- **响应式设计**
  - 模块需支持响应式布局，在不同尺寸屏幕（PC、平板、手机）上均能良好展示。
- **用户提示与交互反馈**
  - 每个操作（查询、重置、导出）均应有明确提示，确保用户操作直观、友好。

------

## 7. 版本管理与文档维护

- **文档版本号管理**：采用语义化版本控制（SemVer），后续所有需求变更须更新版本号。
- **文档存储路径**：例如 `/项目文档/REQ/REQ_综合查询与统计分析模块_v1.1.md`
- **变更历史记录**：记录每次需求调整的内容、日期和审核人，确保需求变更可追溯。

------

## 8. 备注

- 统计与计算规则（如干预效果评估算法、近视等级分类标准）暂时未做明确规定，后续可根据实际需求及数据反馈进行细化。
- 部分功能（如数据导出和查询条件重置）的实现细节在开发过程中可能会根据前后端协作需求进行调整。

------

请您仔细审阅上述文档，确认是否涵盖了您对综合查询与统计分析模块的所有要求，或者指出需要修改、补充的部分。我们将根据您的反馈进一步完善文档，然后进入具体开发阶段。