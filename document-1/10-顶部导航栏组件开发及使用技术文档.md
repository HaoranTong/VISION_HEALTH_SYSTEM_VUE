以下是一份顶部导航栏组件的开发及使用技术文档，采用结构化的 Markdown 格式整理，供参考和存档：

------

# 顶部导航栏组件开发及使用技术文档

## 1. 概述

**目标**
 构建一个独立封装的顶部导航栏组件，提供如下核心功能：

- 展示系统名称、导航按钮、全屏按钮、用户头像及下拉菜单；
- 与侧边栏组件联动，通过 CSS 变量获取侧边栏当前宽度，动态调整自身位置；
- 通过统一命名空间（例如 `visionhealth-topnav`）确保样式及 JavaScript 逻辑不会与其他组件冲突；
- 支持动态交互（如全屏切换、用户下拉菜单显示与隐藏）。

**适用场景**
 适用于整个系统的页面布局中，作为固定的顶部导航区域，与侧边栏共同构成整体页面框架。

## 2. 功能说明

### 2.1 核心功能

- 系统信息显示
  - 展示系统名称或 Logo（通常位于导航栏左侧）。
- 侧边栏折叠按钮
  - 通过按钮触发侧边栏折叠/展开的事件，改变页面布局（该事件通过全局 CSS 变量传递给其他组件）。
- 全屏切换按钮
  - 允许用户切换全屏模式，点击按钮时进入或退出全屏状态。
- 用户头像及下拉菜单
  - 显示用户头像，点击后展开下拉菜单，菜单中包含个人中心、退出登录等选项。

### 2.2 使用说明

- 集成方式
  - 顶部导航栏组件以模板形式存在，位于 `frontend/templates/components/topnav/topnav.html`。
  - 组件样式文件 `topnav.css` 存放于 `frontend/static/components/topnav/` 目录下。
  - JavaScript 逻辑文件 `topnav.js` 存放于同一目录下，并在模板中自动加载。
- 页面集成
  - 在系统基础模板（如 `layouts/base.html`）中使用 `{% include 'components/topnav/topnav.html' %}` 引入顶部导航栏组件。
  - 组件之间通过 CSS 变量（如 `--current-sidebar-width`）实现状态联动，确保顶部导航栏能够根据侧边栏状态自动调整位置。

## 3. 代码结构与关键部分

### 3.1 HTML 模板（topnav.html）

- **位置**：`frontend/templates/components/topnav/topnav.html`

- 功能

  ：定义顶部导航栏的 HTML 结构，包括：

  - 左侧折叠侧边栏按钮；
  - 右侧全屏按钮和用户头像（及下拉菜单）。

示例结构：

```html
<!-- 文件名称：topnav.html -->
<!-- 完整路径：frontend/templates/components/topnav/topnav.html -->
<nav class="visionhealth-topnav">
  <div class="visionhealth-topnav__container">
    <div class="visionhealth-topnav__left">
      <!-- 侧边栏折叠按钮 -->
      <button class="visionhealth-topnav__toggle-btn" id="toggleSidebar">
        <i class="bi bi-list"></i>
      </button>
    </div>
    <div class="visionhealth-topnav__right">
      <!-- 全屏按钮 -->
      <button class="visionhealth-topnav__btn" id="fullscreenBtn">
        <i class="bi bi-fullscreen"></i>
      </button>
      <!-- 用户头像及下拉菜单 -->
      <div class="visionhealth-topnav__user-menu">
        <img src="{{ url_for('static', filename='images/avatar.png') }}"
             alt="用户头像" class="visionhealth-topnav__avatar">
        <div class="visionhealth-topnav__dropdown">
          <a class="visionhealth-topnav__dropdown-item" href="/personal-center">
            <i class="bi bi-person"></i> 个人中心
          </a>
          <hr class="visionhealth-topnav__divider">
          <a class="visionhealth-topnav__dropdown-item" href="/logout">
            <i class="bi bi-box-arrow-right"></i> 退出登录
          </a>
        </div>
      </div>
    </div>
  </div>
  <script src="{{ url_for('static', filename='components/topnav/topnav.js') }}"></script>
</nav>
```

### 3.2 CSS 样式（topnav.css）

- **位置**：`frontend/static/components/topnav/topnav.css`

- 功能

  ：定义顶部导航栏的样式，确保：

  - 使用独立命名空间 `visionhealth-topnav`；
  - 通过 CSS 变量获取侧边栏宽度（例如 `--current-sidebar-width`）；
  - 定义各个部分的布局、背景颜色、按钮样式、下拉菜单样式等。

示例代码片段：

```css
/* 文件名称：topnav.css */
/* 完整存储路径：frontend/static/components/topnav/topnav.css */

:root {
  --visionhealth-topnav-height: 40px;
  --current-sidebar-width: var(--visionhealth-sidebar-width); /* 侧边栏宽度通过全局变量传入 */
}

.visionhealth-topnav {
  height: var(--visionhealth-topnav-height);
  background: #007bff;
  position: fixed;
  top: 0;
  left: var(--current-sidebar-width);
  right: 0;
  z-index: 1000;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  transition: left 0.3s ease;
  display: flex;
  align-items: center;
  padding: 0 15px;
  box-sizing: border-box;
}

.visionhealth-topnav__container {
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.visionhealth-topnav__left,
.visionhealth-topnav__right {
  display: flex;
  align-items: center;
  gap: 15px;
}

.visionhealth-topnav__toggle-btn,
.visionhealth-topnav__btn {
  background: none;
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
}

.visionhealth-topnav__user-menu {
  position: relative;
  cursor: pointer;
}

.visionhealth-topnav__avatar {
  width: 25px;
  height: 25px;
  border-radius: 50%;
  object-fit: cover;
  transition: transform 0.2s;
}

.visionhealth-topnav__avatar:hover {
  transform: scale(1.2);
}

.visionhealth-topnav__dropdown {
  position: absolute;
  top: 100%;
  right: 0;
  background: white;
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16);
  border: 1px solid rgba(0, 0, 0, 0.1);
  width: max-content;
  max-width: 180px;
  padding: 10px 0;
  z-index: 1050;
  display: none;
}

.visionhealth-topnav__dropdown-item {
  padding: 8px 16px;
  text-decoration: none;
  color: #333;
  display: block;
}

.visionhealth-topnav__dropdown-item:hover {
  background-color: #f8f9fa;
}

.visionhealth-topnav__divider {
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  margin: 5px 0;
}
```

### 3.3 JavaScript 逻辑（topnav.js）

- **位置**：`frontend/static/components/topnav/topnav.js`

- 功能

  ：处理顶部导航栏的交互逻辑，包括：

  - 侧边栏折叠按钮点击事件，触发自定义事件；
  - 全屏按钮点击事件，进入或退出全屏；
  - 用户头像点击事件，显示/隐藏下拉菜单。

示例代码片段：

```js
// 文件名称：topnav.js
// 完整存储路径：frontend/static/components/topnav/topnav.js

document.addEventListener('DOMContentLoaded', () => {
  // 侧边栏折叠按钮
  const toggleSidebarBtn = document.getElementById('toggleSidebar');
  toggleSidebarBtn.addEventListener('click', () => {
    document.dispatchEvent(new CustomEvent('visionhealth:toggle-sidebar'));
  });

  // 全屏按钮
  const fullscreenBtn = document.getElementById('fullscreenBtn');
  fullscreenBtn.addEventListener('click', () => {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen();
    } else {
      document.exitFullscreen();
    }
  });

  // 用户头像下拉菜单功能
  const userMenu = document.querySelector('.visionhealth-topnav__user-menu');
  const dropdown = userMenu.querySelector('.visionhealth-topnav__dropdown');

  userMenu.addEventListener('click', () => {
    if (dropdown.style.display === 'block') {
      dropdown.style.display = 'none';
    } else {
      dropdown.style.display = 'block';
    }
    console.log('用户头像点击，下拉菜单状态：', dropdown.style.display);
  });

  // 点击其他地方隐藏下拉菜单
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.visionhealth-topnav__user-menu')) {
      dropdown.style.display = 'none';
    }
  });
});
```

## 4. 集成与部署

### 4.1 页面集成

- 在基础模板（如 

  ```
  layouts/base.html
  ```

  ）中引入顶部导航栏组件：

  ```html
  {% include 'components/topnav/topnav.html' %}
  ```

- 确保基础模板加载了顶部导航栏组件的 CSS 和 JavaScript 文件：

  ```html
  <link rel="stylesheet" href="{{ url_for('static', filename='components/topnav/topnav.css') }}">
  <script src="{{ url_for('static', filename='components/topnav/topnav.js') }}"></script>
  ```

### 4.2 与侧边栏组件的协同

- 顶部导航栏通过全局 CSS 变量 `--current-sidebar-width` 获取侧边栏当前宽度，确保导航栏位置随侧边栏折叠状态同步调整。
- 当侧边栏状态改变时，侧边栏组件会更新该 CSS 变量，顶部导航栏会自动响应调整其 `left` 属性。

## 5. 调试与问题排查

### 5.1 浏览器开发者工具

- **Network 面板**：检查所有资源请求（HTML、JS、CSS、图片等）是否加载成功。确保 `/api/menu` 请求返回正确的 JSON 数据。
- **Console 面板**：查看 JavaScript 错误和调试信息，确保事件绑定和交互逻辑无误。

### 5.2 日志记录

- 使用 `current_app.logger.debug()` 在代码中输出调试信息，便于排查加载与交互过程中的问题。

### 5.3 修改建议

- 在进行任何功能扩展前，请先备份原代码（建议使用 Git 提交）。
- 如需修改样式，请仅在 `topnav.css` 内调整相关规则，确保不影响组件结构。
- 确认组件之间通过统一 CSS 变量和自定义事件正确传递状态信息。

------

这份文档详细描述了顶部导航栏组件的开发思路、代码结构、集成方式及调试流程。请根据文档说明检查各部分代码，确保在后续开发中遵循组件独立性和协同工作的原则。如有疑问，欢迎进一步讨论。